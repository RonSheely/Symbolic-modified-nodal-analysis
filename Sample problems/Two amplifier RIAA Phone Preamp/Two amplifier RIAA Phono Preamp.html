<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Two amplifier RIAA phono preamp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Two amplifier RIAA Phono Preamp_files/libs/clipboard/clipboard.min.js"></script>
<script src="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/quarto.js"></script>
<script src="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/popper.min.js"></script>
<script src="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/anchor.min.js"></script>
<link href="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Two amplifier RIAA Phono Preamp_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Two amplifier RIAA Phono Preamp_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Two amplifier RIAA Phono Preamp_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Two amplifier RIAA Phono Preamp_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Two amplifier RIAA phono preamp</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Last update: 17 Nov 2023</p>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>This Jupyter notebook uses the <a href="https://www.sympy.org/">SymPy</a>, <a href="https://numpy.org/">NumPy</a>,<a href="https://scipy.org/">SciPy</a> and the <a href="https://www.python.org/">Python</a> programming language libraries to analyize a phono preamplifier circuit from [1]. The schematic for the phono preamplifier was entered into <a href="https://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html">LTSpice</a> and the circuit netlist was generated. <a href="https://en.wikipedia.org/wiki/Modified_nodal_analysis">Modified Nodal Analysis</a> was used to derive the circuit equations and Python libraries were used to solve the equations. The preamplifier transfer function was used to calculate the Bode, impuse and step response plots. The Python results were compared to those from LTSpice. Deviation from the RIAA response curve was also examined. Practical implementation considerations are discussed. The sensitivity, error budget and temperature analysis for the preamplifier circuit was performed. Alternate preamplifier circuits were analyized and evaluated. Finally, a new circuit was sythysized from the inverse RIAA tranfser function.</p>
<p><strong>Contents</strong><br>
1. <a href="#section1">Introduction</a><br>
2. <a href="#section2">RIAA pre-emphasis curve</a><br>
3. <a href="#section3">Application note RIAA Phono Preamplifier Design Procedure</a><br>
4. <a href="#section4">Analysis of the phono preamplifier circuit</a><br>
5. <a href="#section5">Alternate designs</a><br>
6. <a href="#section6">Summary</a></p>
<p><strong>License:</strong> This work (includes python code, documentation, test circuits, etc.) is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.<br>
Share — copy and redistribute the material in any medium or format<br>
Adapt — remix, transform, and build upon the material for any purpose, even commercially.<br>
https://creativecommons.org/licenses/by-sa/4.0/</p>
<p><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1) Introduction <a id="section1" href=""></a></h2>
<ul>
<li>what why and how?</li>
</ul>
<p>What is a Phono Preamp and Why Do I Need One? A phono preamplifier, also known as a phono stage, is an audio component that amplifies the signal from your turntable to a level that allows you to connect it to your sound system the same way you would with any other audio source.</p>
<p>Another important job of a phono preamp is to apply the RIAA equalization curve to the signal, reverting it back to the shape it was on the original recording, but if you’re just starting out, this may be a bit deeper than you need to go right now. The most important thing to know is that you will need a phono preamp in order to enjoy your vinyl records.</p>
<p>With the resurgence of vinyl over the last several years, a whole new generation is getting into turntables. With so much “plug and play” technology, we find that people who are younger or have never used a turntable before expect that a turntable will just play, or at least simply connect to their existing stereo system or speakers.</p>
<p>popularity of vynal LP records</p>
<p><a href="https://www.billboard.com/pro/vinyl-sales-new-record-past-cds-2021/#!">1 Out of Every 3 Albums Sold in the US in 2021 Were Vinyl LPs</a></p>
<p><a href="https://www.themanual.com/culture/why-vinyl-is-coming-back/">Why Vinyl Records Are Making a Comeback in 2022</a></p>
<blockquote class="blockquote">
<p>This year, 2020, marks the first year in more than a generation since record sales — that is to say physical vinyl records — have surpassed CD sales. The reasons for this are twofold: CD sales have dropped dramatically in recent years, while sales of vinyl records are actually up this year. And while you might think it’s nostalgic Boomers or Gen Xers behind the renaissance of records, in fact surveys show it’s millennial consumers driving the rising trend in vinyl sales.</p>
</blockquote>
<blockquote class="blockquote">
<p>So vinyl is here to stay, it seems, despite all technological advances that would have seemed to threaten it. The same RIAA study that found records surpassing CDs also revealed that streaming music now account for more than 85% of all music enjoyed. Only 6% of music is now downloaded, even less than is physically purchased in the form of records, CDs, or the last tapes.</p>
</blockquote>
<p>There are hundreds of phon preamps being sold on amazon ranging in price from $10 to $1,000 dollars.</p>
<p>https://www.amazon.com/Pro-Ject-Audio-Phono-preamp-Output/dp/B007DB5I60/ref=sr_1_4?crid=2KH3PW5538BKW&amp;keywords=phono%2Bpre%2Bamp&amp;qid=1700522866&amp;sprefix=phono%2Bpre%2Bamp%2Caps%2C162&amp;sr=8-4&amp;ufe=app_do%3Aamzn1.fos.18630bbb-fcbb-42f8-9767-857e17e03685&amp;th=1</p>
<p>Pro-Ject Phono Box DC MM/MC Phono Preamp with Line Output (Black) Visit the Pro-Ject Store 4.5 4.5 out of 5 stars 759 ratings | 71 answered questions Amazon’s Choice Overall Pick $129.00 $129.00 Or $21.50 /mo (6 mo). Select from 2 plans One-Day FREE Returns</p>
<p>https://www.amazon.com/Cambridge-Audio-Moving-Magnet-Preamplifier/dp/B0793363RG/ref=sr_1_20?crid=2KH3PW5538BKW&amp;keywords=phono+pre+amp&amp;qid=1700522866&amp;sprefix=phono+pre+amp%2Caps%2C162&amp;sr=8-20&amp;ufe=app_do%3Aamzn1.fos.18630bbb-fcbb-42f8-9767-857e17e03685</p>
<p>Cambridge Audio Alva Solo | Phono Preamp for Moving Magnet Turntable Visit the Cambridge Audio Store 4.7 4.7 out of 5 stars 174 ratings | 32 answered questions Amazon’s Choice in Audio Component Preamplifiers by Cambridge Audio Lowest price in 30 days $199.00 with 13 percent savings -13% $199.00 List Price: $229.00 List Price: $229.00</p>
<p>https://www.amazon.com/Schiit-Phono-Preamp-Cartridges-Black/dp/B09S5H9MP6/ref=sr_1_20?crid=2KH3PW5538BKW&amp;keywords=phono+pre+amp&amp;qid=1700522935&amp;sprefix=phono+pre+amp%2Caps%2C162&amp;sr=8-20&amp;ufe=app_do%3Aamzn1.fos.18630bbb-fcbb-42f8-9767-857e17e03685 Schiit Mani 2 Phono Preamp for MM, MC, and MI Cartridges (Black) Visit the Schiit Store 4.5 4.5 out of 5 stars 50 ratings | 11 answered questions Amazon’s Choice in Home Audio Phono Preamps by Schiit $188.00 $188.00 Or $31.33 /mo (6 mo). Select from 2 plans Overnight FREE Returns Or $31.33/month for 6 months with 0% interest financing on your Prime Store Card https://www.schiit.com/products/mani</p>
<p>Mani MM/MC Phono Preamp Finish AC Adapter $149</p>
<p>Skoll Balanced, Discrete MM/MC Phono Preamp with Remote Control AC Adapter $399</p>
<p>https://www.amazon.com/Pro-Ject-Audio-Phono-Preamplifier-Silver/dp/B008UV5CAY/ref=sr_1_4?crid=2KH3PW5538BKW&amp;keywords=phono+pre+amp&amp;qid=1700523083&amp;sprefix=phono+pre+amp%2Caps%2C162&amp;sr=8-4&amp;ufe=app_do%3Aamzn1.fos.ac578592-0362-4e0a-958c-0f2dd61d30d4 Pro-Ject Phono Box RS Premium MM/MC Phono Preamplifier (Silver)</p>
<p>Pro-Ject Phono Box RS Premium MM/MC Phono Preamplifier (Silver) Brand: Pro-Ject 3.2 3.2 out of 5 stars 7 ratings $1,199.00 $1,199.00 Or $99.92 /mo (12 mo). Select from 2 plans FREE Returns Or $99.92/month for 12 months with 0% interest financing on your Prime Store Card</p>
<p>The analysis and design of electronic filters can be mathematically intense, however with modern computer codes, the computatinal burgen is carried by the moder desk top computer. What followes illustrates the easy in which these computations can be perforned. Just like the transitin from slide rules to electronic pocket calculates in the 1970’s, the PC’s of the moder era eliminate smuch of the compoutatinal drgrgery.</p>
<ul>
<li>circuit analysis of ref 1 - what to call referecne circuit?
<ul>
<li>what is the circuit</li>
<li>what does it do</li>
</ul></li>
<li>use of python libraries for circuit analysis</li>
<li>what is the RIAA equalization curve</li>
<li>LP vynal recrodings: <a href="https://en.wikipedia.org/wiki/LP_record">LP record</a></li>
</ul>
<p>AN-346 High-Performance Audio Applications of the LM833</p>
<p>Circuit name: <del>Two amplifier phono preamp LM833 phono preamp</del> The AN-346 phono preamp, refered to as the preamp.</p>
<p>The following circuit is a two Stage RIAA Phono Preamplifier. The circuit was entered into LTSpice and the schematic is shown below:</p>
<p><img src="Two amplifier RIAA Phone Preamp.png" width="750"></p>
<p><a href="https://en.wikipedia.org/wiki/Recording_Industry_Association_of_America">RIAA</a> was formed in 1952. Its original mission was to administer recording copyright fees and problems, work with trade unions, and do research relating to the record industry and government regulations. Early RIAA standards included the RIAA equalization curve, the format of the stereophonic record groove and the dimensions of 33 1/3, 45, and 78 rpm records.</p>
<p>The Op Amps used in the LTSpice simulation are ideal single pole operational amplifiers with Aol=100K and GBW=10Meg. The component reference designators are the same as in [1], except for R20 and R22. The nodes have been numbered from right to left.</p>
<p><span class="math inline">\(\large{\color {red} {\text{remove R22 in next global update}}}\)</span></p>
<p><a href="https://en.wikipedia.org/wiki/RIAA_equalization">RIAA equalization</a> is a specification for the recording and playback of phonograph records, established by the Recording Industry Association of America (RIAA). The purposes of the equalization are to permit greater recording times (by decreasing the mean width of each groove), to improve sound quality and to reduce the groove damage that would otherwise arise during playback. RIAA equalization is a form of pre-emphasis on recording and de-emphasis on playback. A recording is made with the low frequencies reduced and the high frequencies boosted, and on playback, the opposite occurs. The net result is a flat frequency response, but with attenuation of high-frequency noise such as hiss and clicks that arise from the recording medium. Reducing the low frequencies also limits the excursions the cutter needs to make when cutting a groove. Groove width is thus reduced, allowing more grooves to fit into a given surface area, permitting longer recording times. This also reduces physical stresses on the stylus, which might otherwise cause distortion or groove damage during playback.</p>
<p>Phono cartridge output varies depending on the type of phono cartridge. Moving Magnet (MM) or Moving Iron (MI) cartridges typically produce a maximum output of 5mV. Moving Coil (MC) cartridges produce a much lower output, typically around 0.5mV. V1 in the schematic is set to 5mV.</p>
<p>remove programing libraries from references, just hyper link</p>
<p><strong>Reference:</strong><br>
1. <a href="https://www.ti.com/lit/an/snoa586d/snoa586d.pdf">AN-346 High-Performance Audio Applications of the LM833</a>, May 2013, Texas Instruments Incorporated</p>
<pre><code>1. [SymPy](https://www.sympy.org/), Python library for symbolic mathematics
2. [NumPy](https://numpy.org/), Python library for scientific computing
3. [SciPy](https://scipy.org/), algorithms for scientific computing in Python 
4. [Python](https://www.python.org/) [programming language](https://en.wikipedia.org/wiki/Python_(programming_language)), a high-level, general-purpose programming language, 
6. [LTSpice](https://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html), SPICE ("Simulation Program with Integrated Circuit Emphasis") is a general-purpose, open-source analog electronic circuit simulator from [Analog Devices](https://www.analog.com/en/index.html)
7. [Modified Nodal Analysis](https://en.wikipedia.org/wiki/Modified_nodal_analysis), an extension of nodal analysis which not only determines the circuit's node voltages (as in classical nodal analysis), but also some branch currents</code></pre>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="136">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> signal</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy.physics.control.lti <span class="im">import</span> TransferFunction, Series, Parallel</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy.physics.control.control_plots <span class="im">import</span> pole_zero_plot, bode_plot</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>init_printing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="riaa-pre-emphasis-curve" class="level2">
<h2 class="anchored" data-anchor-id="riaa-pre-emphasis-curve">2) RIAA pre-emphasis curve <a id="section2" href=""></a></h2>
<p>RIAA playback equalization is not a simple low-pass filter. It defines transition points in three places: 75 μs, 318 μs and 3180 μs, which correspond to 2122 Hz, 500 Hz and 50 Hz. The pre-emphasis transfer function is expressed as follows, where T1 = 3180 μs, T2 = 318 μs and T3 = 3180 μs.</p>
<p><span class="math inline">\(f(s)=\frac {(sT_{1}+1)(sT_{3}+1)}{(sT_{2}+1)}\)</span></p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<p><span class="math inline">\(\displaystyle 0.159154943091895\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2122</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to rad/s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<p><span class="math inline">\(\displaystyle 337.726789241002\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">500</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to rad/s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="139">
<p><span class="math inline">\(\displaystyle 79.5774715459477\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to rad/s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<p><span class="math inline">\(\displaystyle 7.95774715459477\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="op">/</span><span class="fl">75e-6</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<p><span class="math inline">\(\displaystyle 2122.06590789194\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="op">/</span><span class="fl">318e-6</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<p><span class="math inline">\(\displaystyle 500.487242427344\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="op">/</span><span class="fl">3180e-6</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<p><span class="math inline">\(\displaystyle 50.0487242427344\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">50</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert rad/s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<p><span class="math inline">\(\displaystyle 314.159265358979\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">50</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to sec per cycle in radian units</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<p><span class="math inline">\(\displaystyle 0.00318309886183791\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">500</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to sec per cycle in radian units</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<p><span class="math inline">\(\displaystyle 0.000318309886183791\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2122</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to sec per cycle in radian units</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<p><span class="math inline">\(\displaystyle 7.50023294495265 \cdot 10^{-5}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>F1 <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{:.0f}</span><span class="st"> Hz is {:,.1f} sec per radian cycle'</span>.<span class="bu">format</span>(F1,<span class="dv">1</span><span class="op">/</span>(F1<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi)<span class="op">*</span><span class="fl">1e6</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>F2 <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{:.0f}</span><span class="st"> Hz is {:,.1f} usec per radian cycle'</span>.<span class="bu">format</span>(F2,<span class="dv">1</span><span class="op">/</span>(F2<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi)<span class="op">*</span><span class="fl">1e6</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>F3 <span class="op">=</span> <span class="dv">2122</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'{:,.0f} Hz is </span><span class="sc">{:.1f}</span><span class="st"> usec per radian cycle'</span>.<span class="bu">format</span>(F3,<span class="dv">1</span><span class="op">/</span>(F3<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi)<span class="op">*</span><span class="fl">1e6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>50 Hz is 3,183.1 sec per radian cycle
500 Hz is 318.3 usec per radian cycle
2,122 Hz is 75.0 usec per radian cycle</code></pre>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2122</span><span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>np.pi) <span class="co"># convert to Hz</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<p><span class="math inline">\(\displaystyle 13332.9192218351\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>_ <span class="co"># convert to sec</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<p><span class="math inline">\(\displaystyle 7.50023294495265 \cdot 10^{-5}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="dv">2122</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<p><span class="math inline">\(\displaystyle 7.50023294495265 \cdot 10^{-5}\)</span></p>
</div>
</div>
<p>num1 = Eq(((s<em>3180e-6</em>(2<em>np.pi)+1)</em>(s<em>318e-6</em>(2<em>np.pi)+1))</em>0.018,0) num1</p>
<p>denom1 = Eq(s<em>75e-6</em>(2*np.pi)+1,0) denom1</p>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> symbols(<span class="st">'s'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>num1 <span class="op">=</span> Eq(((s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>num1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="153">
<p><span class="math inline">\(\displaystyle \left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right) = 0\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>denom1 <span class="op">=</span> Eq(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>denom1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="154">
<p><span class="math inline">\(\displaystyle 0.000318 s + 1 = 0\)</span></p>
</div>
</div>
<section id="plot-poles-and-zeros-what-are-the-units" class="level3">
<h3 class="anchored" data-anchor-id="plot-poles-and-zeros-what-are-the-units">plot poles and zeros, what are the units?</h3>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> solve(num1,s)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>zeros</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<p><span class="math inline">\(\displaystyle \left[ -13333.3333333333, \  -314.465408805031\right]\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>zeros[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="158">
<p><span class="math inline">\(\displaystyle -13333.3333333333\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>poles <span class="op">=</span> solve(denom1,s)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>poles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<p><span class="math inline">\(\displaystyle \left[ -3144.65408805031\right]\)</span></p>
</div>
</div>
<div class="cell" data-lable="pole-zero plot" data-execution_count="171">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax.plot(zeros[<span class="dv">0</span>], <span class="dv">0</span>, <span class="st">'ok'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ax.plot(zeros[<span class="dv">1</span>], <span class="dv">0</span>, <span class="st">'ok'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>ax.plot(poles[<span class="dv">0</span>], <span class="dv">0</span>, <span class="st">'xk'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'time (s)'</span>, ylabel<span class="op">=</span><span class="st">'voltage (mV)'</span>, title<span class="op">=</span><span class="st">'test'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A pole zero plot</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tf1 <span class="op">=</span> TransferFunction((s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>), s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>, s)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pole_zero_plot(tf1)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tf1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<p><span class="math inline">\(\displaystyle \frac{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}{0.000318 s + 1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tf1.num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<p><span class="math inline">\(\displaystyle \left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tf1.den</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<p><span class="math inline">\(\displaystyle 0.000318 s + 1\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Poly(tf1.num, s).all_coeffs()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<p><span class="math inline">\(\displaystyle \left[ 2.385 \cdot 10^{-7}, \  0.003255, \  1.0\right]\)</span></p>
</div>
</div>
<p>need to remove commented code</p>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(tf1.num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(tf1.den, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>system_petf <span class="op">=</span> (a, b) <span class="co"># system for pre-emphasis transfer function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">10</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi, <span class="fl">50e3</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi, <span class="dv">10000</span>, endpoint<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>w_petf, mag_petf, phase_petf <span class="op">=</span> signal.bode(system_petf, w<span class="op">=</span>x)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, mag)    # Bode magnitude plot</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi*1e6), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag_petf<span class="op">-</span><span class="dv">20</span>,<span class="st">'-k'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim((-30,30))</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27e6*2*np.pi,33e6*2*np.pi))</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27,33))</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, phase,'-g')  # Bode phase plot</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), phase,':',color=color)  # Bode phase plot</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_petf,<span class="st">':'</span>,color<span class="op">=</span>color)  <span class="co"># Bode phase plot</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bode plot'</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The above looks same as in ref.</p>
<p>Try to plot the difference, use the complex values and then plot mag and phase.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gain <span class="op">=</span> TransferFunction(<span class="op">-</span><span class="fl">.10</span>,<span class="dv">1</span>,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tf1a <span class="op">=</span> Series(tf1, gain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bode_plot(tf1a,initial_exp<span class="op">=</span><span class="dv">1</span>, final_exp<span class="op">=</span><span class="dv">4</span>,freq_unit<span class="op">=</span><span class="st">'Hz'</span>, phase_unit<span class="op">=</span><span class="st">'deg'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Phase is offset and not the same. OK need to fix up the phase or add some comments. or leave un normalized.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tf2 <span class="op">=</span> TransferFunction(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>,(s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>), s)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tf2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s + 1}{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tf3 <span class="op">=</span> Series(tf1, tf2)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>tf3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<p><span class="math inline">\(\displaystyle \left(\frac{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}{0.000318 s + 1}\right) \left(\frac{0.000318 s + 1}{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tf3.to_expr().simplify()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<p><span class="math inline">\(\displaystyle 1\)</span></p>
</div>
</div>
</section>
</section>
<section id="application-note-riaa-phono-preamplifier-design-procedure" class="level2">
<h2 class="anchored" data-anchor-id="application-note-riaa-phono-preamplifier-design-procedure">3) Application note RIAA Phono Preamplifier Design Procedure <a id="section3" href=""></a></h2>
<p>component value calculations …</p>
<p>Even better performance can be obtained by using the two-amplifier approach of Figure 3. The first operational amplifier takes care of the 50 Hz and 500 Hz breakpoints, while the 2122 Hz rolloff is accomplished by the passive network R3, R6, and C3. The second amplifier supplies additional gain—10 dB in this example. Using two amplifiers results in accurate conformance to the RIAA curve without reverting to the noisy inverting topology, as well as lower distortion due to the fact that each amplifier is operating at a lower gain than would be the case in a single-amplifier design. Also, the amplifiers are not required to drive capacitive feedback networks with the full preamplifier output voltages, further reducing distortion compared to the single-amplifier designs.</p>
<p>Also see: Appendix A Derivation of RIAA Phono Preamplifier Design Equation 13, Equation 15, and Equation 16.</p>
<p>}—<br>
In this article, we’ll explore the basics of building a phono preamp, including the necessary power supplies, gain stages, and circuit designs. Whether you’re an experienced electronics experimenter or a beginner looking to dive into DIY audio projects, this guide will provide you with all the information you need to get started.</p>
<p>https://www.andyc.diy-audio-engineering.org/phono-preamp/index.html</p>
<p>}—</p>
<p>Calculations from [1], see page 5 of the app note</p>
<ol type="1">
<li><p>Choose R0. R0 should be small for minimum noise contribution, but not so small that the feedback network excessively loads the amplifier. Example: Choose R0 = 500</p></li>
<li><p>Choose 1 kHz gain, AV1 of first amplifier. This will typically be around 20 dB to 30 dB.Example: Choose AV1 = 26 dB = 20</p></li>
<li><p>Calculate R1 = 8.058<em>R0</em>AV1</p></li>
</ol>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Av1 <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Ro <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>R1 <span class="op">=</span> <span class="fl">8.058</span> <span class="op">*</span> Ro <span class="op">*</span> Av1</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>R1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<p><span class="math inline">\(\displaystyle 80580.0\)</span></p>
</div>
</div>
<ol start="4" type="1">
<li>Calculate C1</li>
</ol>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>C1 <span class="op">=</span> <span class="fl">3.18e-3</span><span class="op">/</span>R1 <span class="co"># C1</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>C1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<p><span class="math inline">\(\displaystyle 3.9463886820551 \cdot 10^{-8}\)</span></p>
</div>
</div>
<ol start="5" type="1">
<li>If C1 is not a convenient value, choose the nearest convenient value and calculate a new R1 from:</li>
</ol>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>C1 <span class="op">=</span> <span class="fl">0.039e-6</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>R1 <span class="op">=</span> <span class="fl">3.18e-3</span><span class="op">/</span>C1</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>R1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<p><span class="math inline">\(\displaystyle 81538.4615384615\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>R1 <span class="op">=</span> <span class="fl">80.6e3</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculate a new value for Ro</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Ro <span class="op">=</span> R1<span class="op">/</span>(<span class="fl">8.058</span><span class="op">*</span>Av1)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Ro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<p><span class="math inline">\(\displaystyle 500.124100273021\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>Ro <span class="op">=</span> <span class="dv">499</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Caluclate R2</li>
</ol>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>R2 <span class="op">=</span> R1<span class="op">/</span><span class="dv">9</span><span class="op">-</span>Ro</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>R2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<p><span class="math inline">\(\displaystyle 8456.55555555555\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>R2 <span class="op">=</span> <span class="fl">8.45e3</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="7" type="1">
<li>Choose a convenient value for C3 in the range from 0.01 μF to 0.05 μF.<br>
Example: C3 = 0.033 μF</li>
</ol>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>C3 <span class="op">=</span> <span class="fl">0.033e-6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="8" type="1">
<li>Calculate Rp</li>
</ol>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>Rp <span class="op">=</span> <span class="fl">7.5e-5</span><span class="op">/</span>C3</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Rp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<p><span class="math inline">\(\displaystyle 2272.72727272727\)</span></p>
</div>
</div>
<ol start="9" type="1">
<li>Choose a standard value for R3 that is slightly larger than RP.<br>
Example: R3 = 2.37k</li>
</ol>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>R3 <span class="op">=</span> <span class="fl">2.37e3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="10" type="1">
<li>Calculate R6 from 1/R6 = 1/RP − 1/R3</li>
</ol>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>R6 <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">/</span>Rp<span class="op">-</span><span class="dv">1</span><span class="op">/</span>R3)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>R6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<p><span class="math inline">\(\displaystyle 55373.8317757009\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>R6 <span class="op">=</span> <span class="fl">54.9e3</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="11" type="1">
<li>Calculate C4 for low-frequency rolloff below 1 Hz from design Equation 5.<br>
Example: C4 = 2 μF. Use a good quality mylar, polystyrene, or polypropylene.</li>
</ol>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Fl <span class="op">=</span> <span class="fl">20.2</span> <span class="co"># Hz</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>C4 <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span>Fl<span class="op">*</span>(R3<span class="op">+</span>R6))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>C4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<p><span class="math inline">\(\displaystyle 1.37575651803854 \cdot 10^{-7}\)</span></p>
</div>
</div>
<ol start="12" type="1">
<li><p>Choose gain of second amplifier.<br>
Example: The 1 kHz gain up to the input of the second amplifier is about 26 dB for this example. For an overall 1 kHz gain equal to about 36 dB we choose:<br>
AV2 = 10 dB = 3.16</p></li>
<li><p>Choose value for R4.<br>
Example: R4 = 2k</p></li>
</ol>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>R4 <span class="op">=</span> <span class="fl">2e3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="14" type="1">
<li>Calculate R5 = (AV2 − 1) R4</li>
</ol>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>Av2 <span class="op">=</span> <span class="fl">3.16</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>R5 <span class="op">=</span> (Av2<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>R4</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>R5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<p><span class="math inline">\(\displaystyle 4320.0\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>R5 <span class="op">=</span> <span class="fl">4.3e3</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="15" type="1">
<li>Calculate C0 for low-frequency rolloff below 1 Hz from design Equation 7.<br>
Example: Co = 200 μF</li>
</ol>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fo <span class="op">=</span> <span class="dv">1</span> <span class="co"># 1 Hz</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>Co <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span>fo<span class="op">*</span>Ro)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Co</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<p><span class="math inline">\(\displaystyle 0.000318947781747285\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>Co <span class="op">=</span> <span class="fl">200e-6</span> <span class="co"># use this value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analysis-of-the-phono-preamplifier-circuit" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-the-phono-preamplifier-circuit">4) Analysis of the phono preamplifier circuit <a id="section4" href=""></a></h2>
<p>The schematic of the preamp was entered into LTSpice and the netlist was generated. Starting with a schematic and then using LTSpice to generate the net list eliminates errors that would occure if these circuits were analyised by hand. For small circuits with a handful of components, symbolic solutions of the node equations can be of interest, but for larger circuits, not so much.</p>
<p>update description</p>
<p>outline<br>
- circuit description - MNA - transfer function</p>
<ol start="4" type="1">
<li><a href="#section4">Analysis of the phono preamplifier circuit</a></li>
<li><a href="#section5">Comparing results to LTSpice</a></li>
<li><a href="#section6">Preamplifier deviation from RIAA response</a></li>
</ol>
<section id="circuit-description" class="level3">
<h3 class="anchored" data-anchor-id="circuit-description">4.1) Circuit description</h3>
<p>The input is shunted by a capacitance, Cs, which is equal to the sum of the input cable capacitance and the cartridge. This capacitance resonates with the inductance of the moving magnet cartridge around 15 kHz to 20 kHz to determine the frequency response of the transducer, so when a moving magnet pickup is used, Cs should be carefully chosen so that the total capacitance is equal to the recommended load capitance for that particular cartridge. 100 pF is used in this analysis.</p>
<p>The first operational amplifier takes care of the 50 Hz and 500 Hz breakpoints, while the 2122 Hz rolloff is accomplished by the passive network R3 , R6 , and C4. The second amplifier supplies additional gain, 10 dB in this example. Using two amplifiers results in accurate conformance to the RIAA curve without reverting to the noisy inverting topology, as well as lower distortion due to the fact that each amplifier is operating at a lower gain than would be the case in a single-amplifier design.</p>
</section>
<section id="modified-nodal-analysis" class="level3">
<h3 class="anchored" data-anchor-id="modified-nodal-analysis">4.2) Modified nodal analysis</h3>
<p>The circuit has 15 branches, 9 nodes, 3 unknown currents, 14 passive components and 2 op amps. The net list generated by LTSpice:<br>
~~~ * Two amplifier RIAA Phone Preamp.asc V1 1 0 AC 5m C1 2 4 0.039µ Co 3 0 200µ Ro 2 3 499 R3 5 6 2.37k R1 2 4 80.6k R2 4 5 8.45k Cp 1 0 100p R20 1 0 47k C3 6 0 0.033µ C4 7 6 2µ R6 7 0 54.9k R4 8 0 2k R5 9 8 4.3k R22 9 0 10k XU1 2 1 5 opamp Aol=100K GBW=10Meg XU2 8 7 9 opamp Aol=100K GBW=10Meg ;op .ac dec 100 10 50000 .lib opamp.sub .backanno .end ~~~</p>
<p>The netlist was edited to remove the opamp power connections and the values of the components were converted to exponential notation with units of Ohms, Farads and Henerys. The edited netlist is: ~~~ * Two amplifier RIAA Phone Preamp.asc with edits V1 1 0 5e-3 C1 2 4 0.039e-6 Co 3 0 200e-6 Ro 2 3 499 R3 5 6 2.37e3 R1 2 4 80.6e3 R2 4 5 8.45e3 Cp 1 0 100e-12 R20 1 0 47e3 C3 6 0 0.033e-6 C4 7 6 2e-6 R6 7 0 54.9e3 R4 8 0 2e3 R5 9 8 4.3e3 R22 9 0 10e3 O1 2 1 5 O2 8 7 9 ;op .ac dec 100 10 50000 .lib opamp.sub .backanno .end ~~~</p>
<p>This netlist is read into the Symbolic Modified Nodal Analysis Jupyter notebook and the following circuit equations were generated.<br>
~~~<br>
⎛ 1 ⎞<br>
I_V1 + v₁⋅⎜Cp⋅s + ───⎟ = 0<br>
⎝ R₂₀⎠<br>
⎛ 1 1 ⎞ ⎛ 1 ⎞ v₃<br>
v₂⋅⎜C₁⋅s + ── + ──⎟ + v₄⋅⎜-C₁⋅s - ──⎟ - ── = 0 ⎝ Ro R₁⎠ ⎝ R₁⎠ Ro<br>
⎛ 1 ⎞ v₂<br>
v₃⋅⎜Co⋅s + ──⎟ - ── = 0 ⎝ Ro⎠ Ro<br>
⎛ 1 ⎞ ⎛ 1 1 ⎞ v₅<br>
v₂⋅⎜-C₁⋅s - ──⎟ + v₄⋅⎜C₁⋅s + ── + ──⎟ - ── = 0 ⎝ R₁⎠ ⎝ R₂ R₁⎠ R₂<br>
⎛1 1 ⎞ v₆ v₄<br>
I_O1 + v₅⋅⎜── + ──⎟ - ── - ── = 0 ⎝R₃ R₂⎠ R₃ R₂<br>
⎛ 1 ⎞ v₅<br>
-C₄⋅s⋅v₇ + v₆⋅⎜C₃⋅s + C₄⋅s + ──⎟ - ── = 0 ⎝ R₃⎠ R₃<br>
⎛ 1 ⎞<br>
-C₄⋅s⋅v₆ + v₇⋅⎜C₄⋅s + ──⎟ = 0 ⎝ R₆⎠<br>
⎛1 1 ⎞ v₉<br>
v₈⋅⎜── + ──⎟ - ── = 0 ⎝R₅ R₄⎠ R₅<br>
⎛1 1 ⎞ v₈<br>
I_O2 + v₉⋅⎜── + ───⎟ - ── = 0 ⎝R₅ R₂₂⎠ R₅<br>
v₁ = V₁ -v₁ + v₂ = 0 -v₇ + v₈ = 0 ~~~</p>
<p>Copy the symbols and matrices generated by the modified nodal analysis code.</p>
<div class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>I_V1, Cp, I_O2, V1, R6, R1, v3, R5, R20, R22, R3, v9, Ro, v5, v7, v4, C4, C1, v1, R4, R2, C3, v8, I_O1, Co, s, v6, v2 <span class="op">=</span> symbols(<span class="st">' I_V1  Cp  I_O2  V1  R6  R1  v3  R5  R20  R22  R3  v9  Ro  v5  v7  v4  C4  C1  v1  R4  R2  C3  v8  I_O1  Co  s  v6  v2 '</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> Matrix([[Cp<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R20, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, C1<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>Ro <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R1, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>Ro, <span class="op">-</span>C1<span class="op">*</span>s <span class="op">-</span> <span class="dv">1</span><span class="op">/</span>R1, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>Ro, Co<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>Ro, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span>C1<span class="op">*</span>s <span class="op">-</span> <span class="dv">1</span><span class="op">/</span>R1, <span class="dv">0</span>, C1<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R2 <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R1, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R2, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R2, <span class="dv">1</span><span class="op">/</span>R3 <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R2, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R3, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R3, C3<span class="op">*</span>s <span class="op">+</span> C4<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R3, <span class="op">-</span>C4<span class="op">*</span>s, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span>C4<span class="op">*</span>s, C4<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R6, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span>R5 <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R4, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R5, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>R5, <span class="dv">1</span><span class="op">/</span>R5 <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>R22, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Matrix( [v1, v2, v3, v4, v5, v6, v7, v8, v9, I_V1, I_O1, I_O2] )</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> Matrix( [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, V1, <span class="dv">0</span>, <span class="dv">0</span>] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>equ <span class="op">=</span> Eq(A<span class="op">*</span>X,Z)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>equ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}I_{V1} + v_{1} \left(Cp s + \frac{1}{R_{20}}\right)\\v_{2} \left(C_{1} s + \frac{1}{Ro} + \frac{1}{R_{1}}\right) + v_{4} \left(- C_{1} s - \frac{1}{R_{1}}\right) - \frac{v_{3}}{Ro}\\v_{3} \left(Co s + \frac{1}{Ro}\right) - \frac{v_{2}}{Ro}\\v_{2} \left(- C_{1} s - \frac{1}{R_{1}}\right) + v_{4} \left(C_{1} s + \frac{1}{R_{2}} + \frac{1}{R_{1}}\right) - \frac{v_{5}}{R_{2}}\\I_{O1} + v_{5} \cdot \left(\frac{1}{R_{3}} + \frac{1}{R_{2}}\right) - \frac{v_{6}}{R_{3}} - \frac{v_{4}}{R_{2}}\\- C_{4} s v_{7} + v_{6} \left(C_{3} s + C_{4} s + \frac{1}{R_{3}}\right) - \frac{v_{5}}{R_{3}}\\- C_{4} s v_{6} + v_{7} \left(C_{4} s + \frac{1}{R_{6}}\right)\\v_{8} \cdot \left(\frac{1}{R_{5}} + \frac{1}{R_{4}}\right) - \frac{v_{9}}{R_{5}}\\I_{O2} + v_{9} \cdot \left(\frac{1}{R_{5}} + \frac{1}{R_{22}}\right) - \frac{v_{8}}{R_{5}}\\v_{1}\\- v_{1} + v_{2}\\- v_{7} + v_{8}\end{matrix}\right] = \left[\begin{matrix}0\\0\\0\\0\\0\\0\\0\\0\\0\\V_{1}\\0\\0\end{matrix}\right]\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find symbolic solution</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> solve(equ,X)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#u # display the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The network system function is the output voltage at node 5, divided by the input voltage, V1.</p>
<p>The symbolic solution obtained by SymPy, while not being very interesting since they are unweildly, they illustrate the power of SymPy to easily obtain symbolic solutions that would be very difficult to obtain by hand.</p>
</section>
<section id="transfer-function" class="level3">
<h3 class="anchored" data-anchor-id="transfer-function">4.3) Transfer function</h3>
<ul>
<li>bode plots</li>
<li>stability margins</li>
</ul>
<p>The network system function is the output voltage at node 9.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>u[v1]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<p><span class="math inline">\(\displaystyle V_{1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> u[v9]<span class="op">/</span>u[v1] <span class="co"># system function</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>H <span class="co"># display the system function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<p><span class="math inline">\(\displaystyle \frac{C_{1} C_{4} Co R_{1} R_{2} R_{4} R_{6} V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{2} R_{5} R_{6} V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{5} R_{6} Ro V_{1} s^{3} + C_{1} C_{4} R_{1} R_{4} R_{6} V_{1} s^{2} + C_{1} C_{4} R_{1} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{1} R_{4} R_{6} V_{1} s^{2} + C_{4} Co R_{1} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{2} R_{4} R_{6} V_{1} s^{2} + C_{4} Co R_{2} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{4} R_{6} Ro V_{1} s^{2} + C_{4} Co R_{5} R_{6} Ro V_{1} s^{2} + C_{4} R_{4} R_{6} V_{1} s + C_{4} R_{5} R_{6} V_{1} s}{V_{1} \left(C_{1} C_{3} C_{4} Co R_{1} R_{3} R_{4} R_{6} Ro s^{4} + C_{1} C_{3} C_{4} R_{1} R_{3} R_{4} R_{6} s^{3} + C_{1} C_{3} Co R_{1} R_{3} R_{4} Ro s^{3} + C_{1} C_{3} R_{1} R_{3} R_{4} s^{2} + C_{1} C_{4} Co R_{1} R_{3} R_{4} Ro s^{3} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro s^{3} + C_{1} C_{4} R_{1} R_{3} R_{4} s^{2} + C_{1} C_{4} R_{1} R_{4} R_{6} s^{2} + C_{1} Co R_{1} R_{4} Ro s^{2} + C_{1} R_{1} R_{4} s + C_{3} C_{4} Co R_{3} R_{4} R_{6} Ro s^{3} + C_{3} C_{4} R_{3} R_{4} R_{6} s^{2} + C_{3} Co R_{3} R_{4} Ro s^{2} + C_{3} R_{3} R_{4} s + C_{4} Co R_{3} R_{4} Ro s^{2} + C_{4} Co R_{4} R_{6} Ro s^{2} + C_{4} R_{3} R_{4} s + C_{4} R_{4} R_{6} s + Co R_{4} Ro s + R_{4}\right)}\)</span></p>
</div>
</div>
<p>pprint(H)</p>
<p>pprint(H,wrap_line=True)</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<p><span class="math inline">\(\displaystyle C_{1} C_{4} Co R_{1} R_{2} R_{4} R_{6} V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{2} R_{5} R_{6} V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro V_{1} s^{3} + C_{1} C_{4} Co R_{1} R_{5} R_{6} Ro V_{1} s^{3} + C_{1} C_{4} R_{1} R_{4} R_{6} V_{1} s^{2} + C_{1} C_{4} R_{1} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{1} R_{4} R_{6} V_{1} s^{2} + C_{4} Co R_{1} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{2} R_{4} R_{6} V_{1} s^{2} + C_{4} Co R_{2} R_{5} R_{6} V_{1} s^{2} + C_{4} Co R_{4} R_{6} Ro V_{1} s^{2} + C_{4} Co R_{5} R_{6} Ro V_{1} s^{2} + C_{4} R_{4} R_{6} V_{1} s + C_{4} R_{5} R_{6} V_{1} s\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>collect((num).expand(),s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<p><span class="math inline">\(\displaystyle s^{3} \left(C_{1} C_{4} Co R_{1} R_{2} R_{4} R_{6} V_{1} + C_{1} C_{4} Co R_{1} R_{2} R_{5} R_{6} V_{1} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro V_{1} + C_{1} C_{4} Co R_{1} R_{5} R_{6} Ro V_{1}\right) + s^{2} \left(C_{1} C_{4} R_{1} R_{4} R_{6} V_{1} + C_{1} C_{4} R_{1} R_{5} R_{6} V_{1} + C_{4} Co R_{1} R_{4} R_{6} V_{1} + C_{4} Co R_{1} R_{5} R_{6} V_{1} + C_{4} Co R_{2} R_{4} R_{6} V_{1} + C_{4} Co R_{2} R_{5} R_{6} V_{1} + C_{4} Co R_{4} R_{6} Ro V_{1} + C_{4} Co R_{5} R_{6} Ro V_{1}\right) + s \left(C_{4} R_{4} R_{6} V_{1} + C_{4} R_{5} R_{6} V_{1}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>solve(num,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<p><span class="math inline">\(\displaystyle \left[ 0, \  - \frac{C_{1} R_{1} + Co R_{1} + Co R_{2} + Co Ro}{2 C_{1} Co R_{1} \left(R_{2} + Ro\right)} - \frac{\sqrt{C_{1}^{2} R_{1}^{2} + 2 C_{1} Co R_{1}^{2} - 2 C_{1} Co R_{1} R_{2} - 2 C_{1} Co R_{1} Ro + Co^{2} R_{1}^{2} + 2 Co^{2} R_{1} R_{2} + 2 Co^{2} R_{1} Ro + Co^{2} R_{2}^{2} + 2 Co^{2} R_{2} Ro + Co^{2} Ro^{2}}}{2 C_{1} Co R_{1} \left(R_{2} + Ro\right)}, \  - \frac{C_{1} R_{1} + Co R_{1} + Co R_{2} + Co Ro}{2 C_{1} Co R_{1} \left(R_{2} + Ro\right)} + \frac{\sqrt{C_{1}^{2} R_{1}^{2} + 2 C_{1} Co R_{1}^{2} - 2 C_{1} Co R_{1} R_{2} - 2 C_{1} Co R_{1} Ro + Co^{2} R_{1}^{2} + 2 Co^{2} R_{1} R_{2} + 2 Co^{2} R_{1} Ro + Co^{2} R_{2}^{2} + 2 Co^{2} R_{2} Ro + Co^{2} Ro^{2}}}{2 C_{1} Co R_{1} \left(R_{2} + Ro\right)}\right]\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>denom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<p><span class="math inline">\(\displaystyle V_{1} \left(C_{1} C_{3} C_{4} Co R_{1} R_{3} R_{4} R_{6} Ro s^{4} + C_{1} C_{3} C_{4} R_{1} R_{3} R_{4} R_{6} s^{3} + C_{1} C_{3} Co R_{1} R_{3} R_{4} Ro s^{3} + C_{1} C_{3} R_{1} R_{3} R_{4} s^{2} + C_{1} C_{4} Co R_{1} R_{3} R_{4} Ro s^{3} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro s^{3} + C_{1} C_{4} R_{1} R_{3} R_{4} s^{2} + C_{1} C_{4} R_{1} R_{4} R_{6} s^{2} + C_{1} Co R_{1} R_{4} Ro s^{2} + C_{1} R_{1} R_{4} s + C_{3} C_{4} Co R_{3} R_{4} R_{6} Ro s^{3} + C_{3} C_{4} R_{3} R_{4} R_{6} s^{2} + C_{3} Co R_{3} R_{4} Ro s^{2} + C_{3} R_{3} R_{4} s + C_{4} Co R_{3} R_{4} Ro s^{2} + C_{4} Co R_{4} R_{6} Ro s^{2} + C_{4} R_{3} R_{4} s + C_{4} R_{4} R_{6} s + Co R_{4} Ro s + R_{4}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>collect((denom).expand(),s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<p><span class="math inline">\(\displaystyle C_{1} C_{3} C_{4} Co R_{1} R_{3} R_{4} R_{6} Ro V_{1} s^{4} + R_{4} V_{1} + s^{3} \left(C_{1} C_{3} C_{4} R_{1} R_{3} R_{4} R_{6} V_{1} + C_{1} C_{3} Co R_{1} R_{3} R_{4} Ro V_{1} + C_{1} C_{4} Co R_{1} R_{3} R_{4} Ro V_{1} + C_{1} C_{4} Co R_{1} R_{4} R_{6} Ro V_{1} + C_{3} C_{4} Co R_{3} R_{4} R_{6} Ro V_{1}\right) + s^{2} \left(C_{1} C_{3} R_{1} R_{3} R_{4} V_{1} + C_{1} C_{4} R_{1} R_{3} R_{4} V_{1} + C_{1} C_{4} R_{1} R_{4} R_{6} V_{1} + C_{1} Co R_{1} R_{4} Ro V_{1} + C_{3} C_{4} R_{3} R_{4} R_{6} V_{1} + C_{3} Co R_{3} R_{4} Ro V_{1} + C_{4} Co R_{3} R_{4} Ro V_{1} + C_{4} Co R_{4} R_{6} Ro V_{1}\right) + s \left(C_{1} R_{1} R_{4} V_{1} + C_{3} R_{3} R_{4} V_{1} + C_{4} R_{3} R_{4} V_{1} + C_{4} R_{4} R_{6} V_{1} + Co R_{4} Ro V_{1}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>solve(denom,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<p><span class="math inline">\(\displaystyle \left[ - \frac{1}{C_{1} R_{1}}, \  - \frac{1}{Co Ro}, \  \frac{- C_{3} R_{3} - C_{4} R_{3} - C_{4} R_{6} - \sqrt{C_{3}^{2} R_{3}^{2} + 2 C_{3} C_{4} R_{3}^{2} - 2 C_{3} C_{4} R_{3} R_{6} + C_{4}^{2} R_{3}^{2} + 2 C_{4}^{2} R_{3} R_{6} + C_{4}^{2} R_{6}^{2}}}{2 C_{3} C_{4} R_{3} R_{6}}, \  \frac{- C_{3} R_{3} - C_{4} R_{3} - C_{4} R_{6} + \sqrt{C_{3}^{2} R_{3}^{2} + 2 C_{3} C_{4} R_{3}^{2} - 2 C_{3} C_{4} R_{3} R_{6} + C_{4}^{2} R_{3}^{2} + 2 C_{4}^{2} R_{3} R_{6} + C_{4}^{2} R_{6}^{2}}}{2 C_{3} C_{4} R_{3} R_{6}}\right]\)</span></p>
</div>
</div>
<p>The following SymPy code collects and expands the system equation around s.</p>
<p>collect((denom/num).expand(),s)</p>
<p>solve(_,s)</p>
<p>The results above are don’t seem to be particulary insightful, but are easily obtained by SymPy.</p>
<p>The element values are entered into the equations so that a numerical solution can be obtained.</p>
<p>The element values are entered into the equations so that a numerical solution can be obtained.</p>
<p>V1 is 0.018 volts is this the same as -35dBv ??</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">*</span>np.log10(<span class="fl">0.018</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<p><span class="math inline">\(\displaystyle -17.4472749489669\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span><span class="op">*</span>np.log10(<span class="fl">0.018</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<p><span class="math inline">\(\displaystyle -34.8945498979339\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">35</span><span class="op">/</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<p><span class="math inline">\(\displaystyle 0.0177827941003892\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">20</span><span class="op">/</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<p><span class="math inline">\(\displaystyle 0.01\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gain of U2, Av = 1 + R5/R4</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">+</span><span class="fl">4.3000e+03</span><span class="op">/</span><span class="fl">2.0000e+03</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<p><span class="math inline">\(\displaystyle 3.15\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>_<span class="op">*</span><span class="fl">0.018</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<p><span class="math inline">\(\displaystyle 0.0567\)</span></p>
</div>
</div>
<p>V1:1.8000e-02,</p>
<p>but try with V1:1</p>
<ul>
<li>component selection
<ul>
<li>Caps</li>
<li>resistors</li>
<li>op amps</li>
</ul></li>
<li>sensitivity, tolerance and temperature analysis</li>
</ul>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>component_values <span class="op">=</span> {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    V1:<span class="fl">5.0000e-03</span>,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    C1:<span class="fl">3.9000e-08</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    Co:<span class="fl">2.0000e-04</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    Ro:<span class="fl">4.9900e+02</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    R3:<span class="fl">2.3700e+03</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    R1:<span class="fl">8.0600e+04</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    R2:<span class="fl">8.4500e+03</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    Cp:<span class="fl">1.0000e-10</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    R20:<span class="fl">4.7000e+04</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    C3:<span class="fl">3.3000e-08</span>,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    C4:<span class="fl">2.0000e-06</span>,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    R6:<span class="fl">5.4900e+04</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    R4:<span class="fl">2.0000e+03</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    R5:<span class="fl">4.3000e+03</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    R22:<span class="fl">1.0000e+04</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="76">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># enter the element values, need to set the current source, I1, to zero</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>equ1a <span class="op">=</span> equ.subs(component_values)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>equ1a  <span class="co"># display the equations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}I_{V1} + v_{1} \cdot \left(1.0 \cdot 10^{-10} s + 2.12765957446809 \cdot 10^{-5}\right)\\v_{2} \cdot \left(3.9 \cdot 10^{-8} s + 0.00201641496392288\right) - 0.00200400801603206 v_{3} + v_{4} \left(- 3.9 \cdot 10^{-8} s - 1.24069478908189 \cdot 10^{-5}\right)\\- 0.00200400801603206 v_{2} + v_{3} \cdot \left(0.0002 s + 0.00200400801603206\right)\\v_{2} \left(- 3.9 \cdot 10^{-8} s - 1.24069478908189 \cdot 10^{-5}\right) + v_{4} \cdot \left(3.9 \cdot 10^{-8} s + 0.000130750143157091\right) - 0.000118343195266272 v_{5}\\I_{O1} - 0.000118343195266272 v_{4} + 0.000540284123536314 v_{5} - 0.000421940928270042 v_{6}\\- 2.0 \cdot 10^{-6} s v_{7} - 0.000421940928270042 v_{5} + v_{6} \cdot \left(2.033 \cdot 10^{-6} s + 0.000421940928270042\right)\\- 2.0 \cdot 10^{-6} s v_{6} + v_{7} \cdot \left(2.0 \cdot 10^{-6} s + 1.82149362477231 \cdot 10^{-5}\right)\\0.000732558139534884 v_{8} - 0.000232558139534884 v_{9}\\I_{O2} - 0.000232558139534884 v_{8} + 0.000332558139534884 v_{9}\\v_{1}\\- v_{1} + v_{2}\\- v_{7} + v_{8}\end{matrix}\right] = \left[\begin{matrix}0\\0\\0\\0\\0\\0\\0\\0\\0\\0.005\\0\\0\end{matrix}\right]\)</span></p>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="77">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> solve(equ1a,X)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>u1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<p><span class="math inline">\(\displaystyle \left\{ I_{O1} : \frac{- 1.26034548442064 \cdot 10^{69} s^{4} - 7.337901387007 \cdot 10^{72} s^{3} - 2.93150814179881 \cdot 10^{75} s^{2} - 9.87547373027578 \cdot 10^{75} s + 1.43134637756693 \cdot 10^{62}}{2.63366442307692 \cdot 10^{73} s^{4} + 3.60161797332146 \cdot 10^{77} s^{3} + 1.18500865315432 \cdot 10^{80} s^{2} + 2.12690398526132 \cdot 10^{81} s + 9.77609967705846 \cdot 10^{81}}, \  I_{O2} : \frac{- 7.15387395812103 \cdot 10^{65} s^{3} - 2.27773966765337 \cdot 10^{69} s^{2} - 1.2715608020359 \cdot 10^{68} s}{7.65600122987477 \cdot 10^{65} s^{4} + 1.0469819689888 \cdot 10^{70} s^{3} + 3.44479259637884 \cdot 10^{72} s^{2} + 6.18286042227129 \cdot 10^{73} s + 2.84188944100537 \cdot 10^{74}}, \  I_{V1} : - 5.0 \cdot 10^{-13} s - 1.06382978723404 \cdot 10^{-7}, \  v_{1} : 0.005, \  v_{2} : 0.005, \  v_{3} : \frac{25.0}{499.0 s + 5000.0}, \  v_{4} : \frac{485551950000000.0 s^{2} + 2.51093323715881 \cdot 10^{19} s + 1.54776674937928 \cdot 10^{18}}{9.711039 \cdot 10^{16} s^{2} + 3.1866474317618 \cdot 10^{19} s + 3.09553349875932 \cdot 10^{20}}, \  v_{5} : \frac{2.06102353846154 \cdot 10^{33} s^{2} + 6.56214394746501 \cdot 10^{36} s + 3.66335325296861 \cdot 10^{35}}{2.29847076923077 \cdot 10^{34} s^{2} + 7.54236078523501 \cdot 10^{36} s + 7.3267065059392 \cdot 10^{37}}, \  v_{6} : \frac{9.66255761116519 \cdot 10^{59} s^{3} + 3.085285819805 \cdot 10^{63} s^{2} + 2.81907417491915 \cdot 10^{64} s + 1.56417594832893 \cdot 10^{63}}{8.42772615384614 \cdot 10^{56} s^{4} + 1.15251775146287 \cdot 10^{61} s^{3} + 3.79202769009382 \cdot 10^{63} s^{2} + 6.80609275283623 \cdot 10^{64} s + 3.12835189665871 \cdot 10^{65}}, \  v_{7} : \frac{1.50977462674456 \cdot 10^{55} s^{3} + 4.80700886915802 \cdot 10^{58} s^{2} + 2.68353936135183 \cdot 10^{57} s}{1.31683221153846 \cdot 10^{52} s^{4} + 1.80080898666073 \cdot 10^{56} s^{3} + 5.9250432657716 \cdot 10^{58} s^{2} + 1.06345199263066 \cdot 10^{60} s + 4.88804983852923 \cdot 10^{60}}, \  v_{8} : \frac{1.50977462674456 \cdot 10^{55} s^{3} + 4.80700886915802 \cdot 10^{58} s^{2} + 2.68353936135183 \cdot 10^{57} s}{1.31683221153846 \cdot 10^{52} s^{4} + 1.80080898666073 \cdot 10^{56} s^{3} + 5.9250432657716 \cdot 10^{58} s^{2} + 1.06345199263066 \cdot 10^{60} s + 4.88804983852923 \cdot 10^{60}}, \  v_{9} : \frac{2.76499422921242 \cdot 10^{69} s^{3} + 8.80353368479522 \cdot 10^{72} s^{2} + 4.91462150480132 \cdot 10^{71} s}{7.65600122987477 \cdot 10^{65} s^{4} + 1.0469819689888 \cdot 10^{70} s^{3} + 3.44479259637884 \cdot 10^{72} s^{2} + 6.18286042227129 \cdot 10^{73} s + 2.84188944100537 \cdot 10^{74}}\right\}\)</span></p>
</div>
</div>
<p>Notice that the values of the exponents are very large in the solution. The numerator and denominator for v5 could be divided by 1e43. Another option for avoiding large exponents is to 1st normalize the component values by frequency scaling. I suppose that large exponents don’t become a problem as long as they remain under two digits.</p>
<p>num, denom = fraction(u1[v7]) (num/1e43)/(denom/1e43)/V1</p>
<p>Almost all platforms map Python floats to the IEEE754 double precision - 64 total bits. The float information using the sys package can be as shown as follows:</p>
<p>import sys sys.float_info</p>
<p>Letting SciPy do the math and not worrying about the size of the exponents. The system transfer function, is <span class="math inline">\(H(s) = \frac {v9}{V1}\)</span></p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>u1[v1] <span class="co">#/V1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<p><span class="math inline">\(\displaystyle 0.005\)</span></p>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> u1[v9]<span class="op">/</span>u1[v1]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<p><span class="math inline">\(\displaystyle \frac{200.0 \cdot \left(2.76499422921242 \cdot 10^{69} s^{3} + 8.80353368479522 \cdot 10^{72} s^{2} + 4.91462150480132 \cdot 10^{71} s\right)}{7.65600122987477 \cdot 10^{65} s^{4} + 1.0469819689888 \cdot 10^{70} s^{3} + 3.44479259637884 \cdot 10^{72} s^{2} + 6.18286042227129 \cdot 10^{73} s + 2.84188944100537 \cdot 10^{74}}\)</span></p>
</div>
</div>
<p>Extract the numerator and denominator polynomials so that the system can be defined in SciPy.</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>pprint(H,wrap_line<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          ⎛                      3                         2                         ⎞                    
                    200.0⋅⎝2.76499422921242e+69⋅s  + 8.80353368479522e+72⋅s  + 4.91462150480132e+71⋅s⎠                    
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                      4                        3                         2                                                
7.65600122987477e+65⋅s  + 1.0469819689888e+70⋅s  + 3.44479259637884e+72⋅s  + 6.18286042227129e+73⋅s + 2.84188944100537e+74</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<p><span class="math inline">\(\displaystyle 5.52998845842485 \cdot 10^{71} s^{3} + 1.76070673695904 \cdot 10^{75} s^{2} + 9.82924300960264 \cdot 10^{73} s\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>solve(num,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<p><span class="math inline">\(\displaystyle \left[ -3183.86896860174, \  -0.0558265334651996, \  0.0\right]\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>solve(denom,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<p><span class="math inline">\(\displaystyle \left[ -13338.433641045 - 1.10200719980902 \cdot 10^{-30} i, \  -318.126868995356 - 3.52548590641477 \cdot 10^{-30} i, \  -10.0200400801603 + 2.68707200346262 \cdot 10^{-30} i, \  -8.73032761723183 + 1.94042110276117 \cdot 10^{-30} i\right]\)</span></p>
</div>
</div>
<p>RIAA playback equalization is not a simple low-pass filter. It defines transition points in three places: 75 μs, 318 μs and 3180 μs, which correspond to 2122 Hz, 500 Hz and 50 Hz. The pre-emphasis transfer function is expressed as follows, where T1=3180 μs, T2=318 μs, etc.:</p>
<p><span class="math inline">\(f(s)=\frac {(sT_{1}+1)(sT_{3}+1)}{(sT_{2}+1)}\)</span></p>
<p>Zeros: 3183.86896860175</p>
<p>Poles: 318.126868995356,</p>
</section>
<section id="pole-zero-plot" class="level3">
<h3 class="anchored" data-anchor-id="pole-zero-plot">4.4) Pole zero plot</h3>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">## plot poles and zeros</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>tf2 <span class="op">=</span> TransferFunction(num, denom, s)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#pole_zero_plot(tf1,show=False)</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>pole_zero_plot(tf2,show<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-98-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="bode-plot" class="level3">
<h3 class="anchored" data-anchor-id="bode-plot">4.5) Bode plot</h3>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span><span class="op">*</span>np.log10(<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<p><span class="math inline">\(\displaystyle -20.0\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">35</span><span class="op">/</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<p><span class="math inline">\(\displaystyle 0.0177827941003892\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>gain1 <span class="op">=</span> TransferFunction(<span class="op">-</span><span class="fl">0.0177827941003892</span>,<span class="dv">1</span>,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>tf2a <span class="op">=</span> Series(tf2, gain1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>bode_plot(tf2a,initial_exp<span class="op">=</span><span class="dv">1</span>, final_exp<span class="op">=</span><span class="dv">4</span>,freq_unit<span class="op">=</span><span class="st">'Hz'</span>, phase_unit<span class="op">=</span><span class="st">'deg'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="plot-poles-and-zeros" class="level2">
<h2 class="anchored" data-anchor-id="plot-poles-and-zeros">plot poles and zeros</h2>
<p>tf2 = TransferFunction(num, denom, s)</p>
<p>pole_zero_plot(tf1,show=True) pole_zero_plot(tf2,show=True)</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>S1 <span class="op">=</span> Series(tf1a, tf2a)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>S1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<p><span class="math inline">\(\displaystyle \left(\frac{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}{0.000318 s + 1}\right) \left(\frac{-0.1}{1}\right) \left(\frac{5.52998845842485 \cdot 10^{71} s^{3} + 1.76070673695904 \cdot 10^{75} s^{2} + 9.82924300960264 \cdot 10^{73} s}{7.65600122987477 \cdot 10^{65} s^{4} + 1.0469819689888 \cdot 10^{70} s^{3} + 3.44479259637884 \cdot 10^{72} s^{2} + 6.18286042227129 \cdot 10^{73} s + 2.84188944100537 \cdot 10^{74}}\right) \left(\frac{-0.0177827941003892}{1}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>pole_zero_plot(S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-106-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>bode_plot(S1,initial_exp<span class="op">=</span><span class="dv">1</span>, final_exp<span class="op">=</span><span class="dv">4</span>,freq_unit<span class="op">=</span><span class="st">'Hz'</span>, phase_unit<span class="op">=</span><span class="st">'deg'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-107-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="94">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>system_c1 <span class="op">=</span> (a, b) <span class="co"># system for circuit 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="impulse-and-step-response" class="level3">
<h3 class="anchored" data-anchor-id="impulse-and-step-response">4.6) Impulse and step response</h3>
<p>Use the SciPy functions <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.impulse2.html">impulse2</a> and <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.step2.html">step2</a> to plot the impulse and step response of the system.</p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using subplot function and creating</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot one</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># impulse response</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>t, y <span class="op">=</span> signal.impulse2(system_c1,N<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>plt.plot(t<span class="op">/</span><span class="fl">1e-3</span>, y)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Impulse response'</span>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="co"># using subplot function and creating plot two</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>t, y <span class="op">=</span> signal.step2(system_c1,N<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>plt.plot(t<span class="op">/</span><span class="fl">1e-3</span>, y)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="co"># space between the plots</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.tight_layout(4)</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-109-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The <a href="https://en.wikipedia.org/wiki/Impulse_response">impulse</a> and <a href="https://en.wikipedia.org/wiki/Step_response">step response</a> of the filter are plotted above. Any linear, time-invariant is completely characterized by its impulse response. The transfer function is the Laplace transform of the impulse response. The impulse response defines the response of a linear time-invariant system for all frequencies.</p>
<p>In practical systems, it is not possible to produce a perfect impulse to serve as input for testing; therefore, a brief pulse is sometimes used as an approximation of an impulse. Provided that the pulse is short enough compared to the impulse response, the result will be close to the true, theoretical, impulse response.</p>
<p>In electronic engineering and control theory, step response is the time behavior of the outputs of a general system when its inputs change from zero to one in a very short time.</p>
</section>
<section id="bode-plot---see-above-need-to-re-organize" class="level3">
<h3 class="anchored" data-anchor-id="bode-plot---see-above-need-to-re-organize">Bode plot - See above, need to re organize</h3>
<p>Use the SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.bode.html">bode</a> to plot the magnitude and phase of the filter.</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">10</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi, <span class="fl">50e3</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi, <span class="dv">10000</span>, endpoint<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>w_c1, mag_c1, phase_c1 <span class="op">=</span> signal.bode(system_c1, w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, mag)    # Bode magnitude plot</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi*1e6), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag_c1<span class="op">-</span><span class="fl">34.8387</span>,<span class="st">'-k'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim((-30,20))</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27e6*2*np.pi,33e6*2*np.pi))</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27,33))</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, phase,'-g')  # Bode phase plot</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), phase,':',color=color)  # Bode phase plot</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_c1,<span class="st">':'</span>,color<span class="op">=</span>color)  <span class="co"># Bode phase plot</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bode plot'</span>)</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-110-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="find-gain-at-1khz" class="level2">
<h2 class="anchored" data-anchor-id="find-gain-at-1khz">find gain at 1Khz</h2>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>w_c1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>array([6.28318531e+01, 9.42446377e+01, 1.25657422e+02, ...,
       3.14096440e+05, 3.14127853e+05, 3.14159265e+05])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>np.diff(w_c1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>array([31.41278463, 31.41278463, 31.41278463, ..., 31.41278463,
       31.41278463, 31.41278463])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>np.gradient(w_c1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>array([31.41278463, 31.41278463, 31.41278463, ..., 31.41278463,
       31.41278463, 31.41278463])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>mag_c1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>array([54.32273597, 54.23176407, 54.00773139, ...,  7.22580122,
        7.22493407,  7.224067  ])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>array([1.00000000e+01, 1.49994999e+01, 1.99989999e+01, ...,
       4.99900010e+04, 4.99950005e+04, 5.00000000e+04])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>np.where(w_c1 <span class="op">&gt;</span> <span class="fl">999.9</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>(array([ 198,  199,  200, ..., 9997, 9998, 9999]),)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>w_c1[<span class="dv">198</span>]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<p><span class="math inline">\(\displaystyle 999.90099009901\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>w_c1[<span class="dv">199</span>]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<p><span class="math inline">\(\displaystyle 1004.900490049\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>mag_c1[<span class="dv">199</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<p><span class="math inline">\(\displaystyle 34.7671616946591\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>mag_c1[<span class="dv">198</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<p><span class="math inline">\(\displaystyle 34.7837666511942\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>phase_c1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>array([  6.60864219,  -3.88378121, -11.32515646, ..., -88.08765905,
       -88.08785   , -88.08804091])</code></pre>
</div>
</div>
<p>In electrical engineering, a <a href="https://en.wikipedia.org/wiki/Bode_plot">Bode plot</a> is a graph of the frequency response of a system. It is usually a combination of the magnitude (usually in decibels) of the frequency response and the phase shift. As originally conceived by Hendrik Wade Bode in the 1930s, the plot is an asymptotic approximation of the frequency response, using straight line segments. Bode plots are used to assess the stability of systems by finding the gain and phase margins.</p>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find neasest position in the array where the value is located</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_nearest(array,value):</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    idx,val <span class="op">=</span> <span class="bu">min</span>(<span class="bu">enumerate</span>(array), key<span class="op">=</span><span class="kw">lambda</span> x: <span class="bu">abs</span>(x[<span class="dv">1</span>]<span class="op">-</span>value))</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gain margin</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'gain margin = </span><span class="sc">{:.2f}</span><span class="st"> dB'</span>.<span class="bu">format</span>(mag_c1[find_nearest(phase_c1, <span class="op">-</span><span class="dv">180</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gain margin = 7.22 dB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># phase margin</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'phase margin = </span><span class="sc">{:.2f}</span><span class="st"> deg'</span>.<span class="bu">format</span>(phase_c1[find_nearest(mag_c1, <span class="op">-</span><span class="fl">0.1</span> )] <span class="op">-</span> (<span class="op">-</span><span class="dv">180</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>phase margin = 91.91 deg</code></pre>
</div>
</div>
<section id="group-delay" class="level3">
<h3 class="anchored" data-anchor-id="group-delay">4.7) Group delay</h3>
<p>The following python code calculates and plots <a href="https://en.wikipedia.org/wiki/Group_delay_and_phase_delay#">group delay</a>. Frequency components of a signal are delayed when passed through a circuit and the signal delay will be different for the various frequencies unless the circuit has the property of being linear phase. The delay variation means that signals consisting of multiple frequency components will suffer distortion because these components are not delayed by the same amount of time at the output of the device.</p>
<p>Group delay: <span class="math inline">\(\tau _{g}(\omega )=-\frac {d\phi (\omega )}{d\omega }\)</span></p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Filter group delay'</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w_c1/(2*np.pi), -np.gradient(phase_c1)/np.gradient(w_c1)/1e-3,'-',label='group delay')</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase_c1)<span class="op">/</span>np.gradient(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)),<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w_c1/(2*np.pi), -np.gradient(phase_c1)/w_c1/1e-3,'-',label='phase delay')</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-127-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>get data from LTSpice and compare results on a graph. LTSpice runs from 7 to 0 ms.</p>
<p>Seem like need to mult by 20 to get same group delay. Why 20 ??</p>
<p>The results obtained from the python code do not agree with LTspice. LTspice shows the group delay at 100Hz to be -278.4us, the plot above shows 16msec at about 100Hz. LTspice gives the phase at -10.5 deg at 100Hz, the bode plot above shows about -10 degrees. This difference needs to be explored.</p>
<p>The results above are don’t seem to be particulary insightful, but are easily obtained by SymPy.</p>
<p>The element values are entered into the equations so that a numerical solution can be obtained.</p>
<p>The plot above shows that for frequencies below 200 Hz, there is a large amount of delay that is frequency dependent. Presumably, the delay compensates for the de-emphases introduced in the record cutting process.</p>
</section>
<section id="comparing-results-to-ltspice" class="level3">
<h3 class="anchored" data-anchor-id="comparing-results-to-ltspice">4.8) Comparing results to LTSpice</h3>
<ul>
<li>with LTSpice</li>
<li></li>
</ul>
<p>/home/jeff64/Documents/Solving Electrical Engineering Problems with Python Blog/MNA Problem Circuits/Two amplifier RIAA Phone Preamp.csv</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">'/home/jeff32/Documents/Solving Electrical Engineering Problems with Python Blog/MNA Problem Circuits/Two amplifier RIAA Phone Preamp/'</span>) <span class="co"># change directory to csv file location</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> <span class="st">'Two amplifier RIAA Phone Preamp.csv'</span> <span class="co"># data from LTSpice</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>LTSpice_data <span class="op">=</span> np.genfromtxt(fn, delimiter<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co"># change the working director back to the Jupyter folder</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">'/home/jeff32/Documents/JupyterLab/Node Analysis/'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>frequency <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>voltage <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data)).astype(<span class="bu">complex</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(LTSpice_data)):</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    frequency[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">0</span>]</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    voltage[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">1</span>] <span class="op">+</span> LTSpice_data[i][<span class="dv">2</span>]<span class="op">*</span><span class="ot">1j</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(frequency, <span class="dv">20</span><span class="op">*</span>np.log10(np.<span class="bu">abs</span>(voltage))<span class="op">+</span><span class="fl">11.257</span>,<span class="st">'-k'</span>)    <span class="co"># Bode magnitude plot, adding 11.257 dBV offset to normalized LTSpice data at 1KHz</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag_c1<span class="op">-</span><span class="fl">34.8387</span>,<span class="st">'-b'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="dv">30</span>,<span class="dv">20</span>))</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>plt.semilogx(frequency, np.angle(voltage)<span class="op">*</span><span class="dv">180</span><span class="op">/</span>np.pi,<span class="st">':'</span>,color<span class="op">=</span>color)  <span class="co"># Bode phase plot</span></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_c1,<span class="st">':'</span>,color<span class="op">=</span><span class="st">'tab:red'</span>)  <span class="co"># Bode phase plot</span></span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bode plot'</span>)</span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-132-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, mag)    # Bode magnitude plot</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi*1e6), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag_petf<span class="op">-</span><span class="dv">20</span>,<span class="st">'-k'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag_c1<span class="op">-</span><span class="fl">34.8387</span>,<span class="st">'-b'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim((-30,20))</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27e6*2*np.pi,33e6*2*np.pi))</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27,33))</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, phase,'-g')  # Bode phase plot</span></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), phase,':',color=color)  # Bode phase plot</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_petf,<span class="st">':'</span>,color<span class="op">=</span>color)  <span class="co"># Bode phase plot</span></span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_c1<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_c1,<span class="st">':'</span>,color<span class="op">=</span><span class="st">'tab:red'</span>)  <span class="co"># Bode phase plot</span></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bode plot'</span>)</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-135-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="preamplifier-deviation-from-riaa-response" class="level3">
<h3 class="anchored" data-anchor-id="preamplifier-deviation-from-riaa-response">4.9) Preamplifier deviation from RIAA response</h3>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, mag)    # Bode magnitude plot</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi*1e6), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), mag,'-k')    # Bode magnitude plot</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), (mag_petf<span class="op">-</span><span class="dv">20</span>) <span class="op">+</span> mag_c1<span class="op">-</span><span class="fl">34.8387</span>,<span class="st">'-k'</span>)    <span class="co"># Bode magnitude plot</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w_c1/(2*np.pi), mag_c1,'-b')    # Bode magnitude plot</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim((-30,20))</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((20*2*np.pi,20e3*2*np.pi))</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim((27,33))</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w, phase,'-g')  # Bode phase plot</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(w/(2*np.pi), phase,':',color=color)  # Bode phase plot</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w_petf<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase_petf<span class="op">+</span>phase_c1,<span class="st">':'</span>,color<span class="op">=</span>color)  <span class="co"># Bode phase plot</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.semilogx(w_c1/(2*np.pi), phase_c1,':',color='tab:red')  # Bode phase plot</span></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_xlim((20*2*np.pi,20e3*2*np.pi))</span></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bode plot'</span>)</span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Two%20amplifier%20RIAA%20Phono%20Preamp_files/figure-html/cell-136-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Comments:</p>
</section>
<section id="implementation-considerations" class="level3">
<h3 class="anchored" data-anchor-id="implementation-considerations">4.10) Implementation considerations</h3>
<p>Comments on alternate realization. - LP vinal source is inherently noisy, don’t need preamp to be 10x better, only blameless - power supply design - choice of OpAmps, Caps and resistors - other filter</p>
<ul>
<li>component selection
<ul>
<li>Caps</li>
<li>resistors</li>
<li>op amps</li>
</ul></li>
<li>sensitivity, tolerance and temperature analysis</li>
</ul>
<p>Other links</p>
<p>https://sound-au.com/project27.htm https://sound-au.com/project25.htm https://sound-au.com/project06.htm</p>
</section>
</section>
<section id="alternate-designs" class="level2">
<h2 class="anchored" data-anchor-id="alternate-designs">5) Alternate designs <a id="section5" href=""></a></h2>
<p>search for RIAA preamp schematics</p>
<p>https://www.petervis.com/record_players_and_turntables/riaa-preamp-circuit-lf353n/phono-preamplifier.html</p>
<p>https://www.pinterest.com/pin/600878775274473107/ https://paulinthelab.blogspot.com/2014/05/riaa-phono-preamp-stripboard-layout.html</p>
<p>https://www.tubecad.com/2020/03/blog0496.htm</p>
<section id="circuit-1" class="level3">
<h3 class="anchored" data-anchor-id="circuit-1">5.1) circuit 1</h3>
</section>
<section id="circuit-2" class="level3">
<h3 class="anchored" data-anchor-id="circuit-2">5.2) circuit 2</h3>
</section>
<section id="circuit-n" class="level3">
<h3 class="anchored" data-anchor-id="circuit-n">5.2) circuit N</h3>
</section>
<section id="x-filter-sysnthese-from-the-transfer-function" class="level3">
<h3 class="anchored" data-anchor-id="x-filter-sysnthese-from-the-transfer-function">5.X) Filter sysnthese from the transfer function</h3>
<p>OK, now considering the inverse of the pre-emphis curve.</p>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>tf2 <span class="op">=</span> TransferFunction(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>,(s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>), s)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>tf2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s + 1}{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>tf2.expand()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s + 1}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>tf2_expanded <span class="op">=</span> tf2.to_expr().expand()</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>tf2_expanded</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1} + \frac{1}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1}\)</span></p>
</div>
</div>
<p>See Electronic Filter Design Handbook page 2.4, eq (2-3) for 2nd term and page 5.52 eq (5.89) for 1st term. Synthesis by equating coefficients.</p>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>expr1 <span class="op">=</span> tf2_expanded.args[<span class="dv">1</span>]</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>expr1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>expr2 <span class="op">=</span> apart(tf2_expanded.args[<span class="dv">0</span>])</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>expr2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<p><span class="math inline">\(\displaystyle \frac{1.0}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1.0}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>expr1 <span class="op">+</span> expr2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1} + \frac{1.0}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1.0}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>(expr1 <span class="op">+</span> expr2).simplify()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<p><span class="math inline">\(\displaystyle \frac{7.5843 \cdot 10^{-11} s^{3} + 1.27359 \cdot 10^{-6} s^{2} + 0.003573 s + 1.0}{5.68822499999996 \cdot 10^{-14} s^{4} + 1.552635 \cdot 10^{-9} s^{3} + 1.1072025 \cdot 10^{-5} s^{2} + 0.00651 s + 1.0}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>(expr1 <span class="op">+</span> expr2).factor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<p><span class="math inline">\(\displaystyle \frac{1.0 \cdot \left(7.5843 \cdot 10^{-11} s^{3} + 1.27359 \cdot 10^{-6} s^{2} + 0.003573 s + 1.0\right)}{\left(2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1.0\right)^{2}}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>(expr1 <span class="op">+</span> expr2).factor().expand()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<p><span class="math inline">\(\displaystyle \frac{7.5843 \cdot 10^{-11} s^{3}}{5.688225 \cdot 10^{-14} s^{4} + 1.552635 \cdot 10^{-9} s^{3} + 1.1072025 \cdot 10^{-5} s^{2} + 0.00651 s + 1.0} + \frac{1.27359 \cdot 10^{-6} s^{2}}{5.688225 \cdot 10^{-14} s^{4} + 1.552635 \cdot 10^{-9} s^{3} + 1.1072025 \cdot 10^{-5} s^{2} + 0.00651 s + 1.0} + \frac{0.003573 s}{5.688225 \cdot 10^{-14} s^{4} + 1.552635 \cdot 10^{-9} s^{3} + 1.1072025 \cdot 10^{-5} s^{2} + 0.00651 s + 1.0} + \frac{1.0}{5.688225 \cdot 10^{-14} s^{4} + 1.552635 \cdot 10^{-9} s^{3} + 1.1072025 \cdot 10^{-5} s^{2} + 0.00651 s + 1.0}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>(expr1 <span class="op">+</span> expr2) <span class="co">#.expand()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1} + \frac{1.0}{2.385 \cdot 10^{-7} s^{2} + 0.003255 s + 1.0}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>((s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s + 1}{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>(s<span class="op">*</span><span class="fl">3180e-6</span><span class="op">+</span><span class="dv">1</span>) <span class="co">#*(1/*(s*75e-6+1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<p><span class="math inline">\(\displaystyle \frac{0.000318 s + 1}{0.00318 s + 1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(s<span class="op">*</span><span class="fl">75e-6</span><span class="op">+</span><span class="dv">1</span>) <span class="co"># This is a high pass section</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<p><span class="math inline">\(\displaystyle \frac{1}{7.5 \cdot 10^{-5} s + 1}\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>(s<span class="op">*</span><span class="fl">318e-6</span><span class="op">+</span><span class="dv">1</span>).factor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<p><span class="math inline">\(\displaystyle 1.0 \cdot \left(0.000318 s + 1.0\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>tf3 <span class="op">=</span> Series(tf1, tf2)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>tf3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<p><span class="math inline">\(\displaystyle \left(\frac{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}{0.000318 s + 1}\right) \left(\frac{0.000318 s + 1}{\left(7.5 \cdot 10^{-5} s + 1\right) \left(0.00318 s + 1\right)}\right)\)</span></p>
</div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>tf3.to_expr().simplify()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<p><span class="math inline">\(\displaystyle 1\)</span></p>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">6) Summary <a id="section6" href=""></a></h2>
<ul>
<li>gain errors don’t agree</li>
<li>group delay not in agreement</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>